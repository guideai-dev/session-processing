
> @guideai-dev/session-processing@0.1.29 test /Users/cliftonc/work/guideai/packages/session-processing
> vitest run


 RUN  v2.1.9 /Users/cliftonc/work/guideai/packages/session-processing

 ✓ tests/parsers/base/BaseParser.test.ts (43 tests) 5ms
 ✓ tests/processors/base/git-diff-processor.test.ts (19 tests) 4ms
 ✓ tests/processors/providers/claude-code/metrics/engagement.test.ts (16 tests) 4ms
 ✓ tests/processors/base/provider-processor.test.ts (30 tests) 9ms
 ✓ tests/processors/providers/claude-code/metrics/error.test.ts (19 tests) 4ms
 ❯ tests/processors/providers/claude-code/metrics/usage.test.ts (24 tests | 5 failed) 9ms
   × ClaudeUsageProcessor > input clarity scoring > should score high for technical terms 3ms
     → expected 0 to be greater than 0
   × ClaudeUsageProcessor > input clarity scoring > should score high for code snippets 0ms
     → expected 0 to be greater than 0
   × ClaudeUsageProcessor > input clarity scoring > should score high for file references 0ms
     → expected 0 to be greater than 0
   × ClaudeUsageProcessor > input clarity scoring > should average scores across multiple user messages 0ms
     → expected 0 to be greater than 0
   × ClaudeUsageProcessor > metadata tracking > should track total user messages 1ms
     → expected +0 to be 3 // Object.is equality
 ❯ tests/processors/providers/claude-code/metrics/quality.test.ts (21 tests | 2 failed) 8ms
   × ClaudeQualityProcessor > iteration counting > should detect corrections and refinements 3ms
     → expected +0 to be 2 // Object.is equality
   × ClaudeQualityProcessor > iteration counting > should detect interruptions as iterations 0ms
     → expected +0 to be 1 // Object.is equality
 ✓ tests/processors/providers/claude-code/metrics/performance.test.ts (15 tests) 5ms
 ✓ tests/parsers/providers/gemini/gemini-parser.test.ts (31 tests) 35ms
 ❯ tests/processors/providers/gemini/metrics/usage.test.ts (19 tests | 3 failed) 8ms
   × GeminiUsageProcessor > read/write ratio with Gemini format > should calculate ratio when both reads and writes exist 3ms
     → expected 1 to be 2 // Object.is equality
   × GeminiUsageProcessor > read/write ratio with Gemini format > should return read count when no writes exist 0ms
     → expected 1 to be 2 // Object.is equality
   × GeminiUsageProcessor > read/write ratio with Gemini format > should detect edit operations as writes 0ms
     → expected 0 to be greater than 0
 ✓ tests/processors/providers/gemini/metrics/performance.test.ts (12 tests) 3ms
 ✓ tests/parsers/providers/codex/codex-parser.test.ts (27 tests) 14ms
 ✓ tests/ai-models/base-model-task.test.ts (21 tests) 3ms
 ✓ tests/parsers/providers/github-copilot/github-copilot-parser.test.ts (27 tests) 26ms
 ❯ tests/processors/providers/gemini/metrics/quality.test.ts (13 tests | 1 failed) 5ms
   × GeminiQualityProcessor > iteration counting > should detect corrections and iterations 2ms
     → expected 0 to be greater than 0
 ✓ tests/parsers/providers/opencode/opencode-parser.test.ts (31 tests) 279ms
 ❯ tests/processors/providers/gemini/metrics/error.test.ts (15 tests | 2 failed) 6ms
   × GeminiErrorProcessor > health scoring > should return high health score for error-free session 3ms
     → expected +0 to be 100 // Object.is equality
   × GeminiErrorProcessor > recovery attempts > should count consecutive same-type errors as recovery attempts 0ms
     → expected 0 to be greater than 0
 ✓ tests/processors/providers/gemini/gemini-processor.test.ts (18 tests) 8ms
 ✓ tests/ai-models/session-phase-analysis.test.ts (27 tests) 8ms
 ✓ tests/processors/registry.test.ts (27 tests) 6ms
 ✓ tests/parsers/providers/claude-code/claude-code-parser.test.ts (36 tests) 386ms
 ✓ tests/processors/providers/github-copilot/github-copilot-processor.test.ts (17 tests) 9ms
 ✓ tests/processors/providers/opencode/opencode-processor.test.ts (17 tests) 43ms
 ✓ tests/processors/base/metric-processor.test.ts (19 tests) 4ms
 ❯ tests/processors/providers/gemini/metrics/engagement.test.ts (11 tests | 6 failed) 11ms
   × GeminiEngagementProcessor > interruption detection > should detect consecutive user messages as interruptions 4ms
     → expected 0 to be greater than or equal to 1
   × GeminiEngagementProcessor > interruption detection > should detect "wait" keyword as interruption 0ms
     → expected 0 to be greater than or equal to 1
   × GeminiEngagementProcessor > interruption detection > should detect "stop" keyword as interruption 0ms
     → expected 0 to be greater than or equal to 1
   × GeminiEngagementProcessor > interruption detection > should detect "actually" keyword as interruption 0ms
     → expected 0 to be greater than or equal to 1
   × GeminiEngagementProcessor > interruption detection > should calculate interruption rate correctly 1ms
     → expected +0 to be 50 // Object.is equality
   × GeminiEngagementProcessor > engagement scoring > should score higher for more turns 0ms
     → expected 0 to be greater than 0
 ✓ tests/processors/providers/claude-code/claude-code-processor.test.ts (16 tests) 15ms
 ✓ tests/ai-models/session-summary.test.ts (22 tests) 3ms
 ❯ tests/processors/providers/opencode/metrics/engagement.test.ts (6 tests | 3 failed) 9ms
   × OpenCodeEngagementProcessor > interruption detection > should detect consecutive user messages as interruptions 2ms
     → expected 0 to be greater than or equal to 1
   × OpenCodeEngagementProcessor > interruption detection > should calculate interruption rate correctly 1ms
     → expected +0 to be 50 // Object.is equality
   × OpenCodeEngagementProcessor > engagement scoring > should calculate engagement score between 0-100 1ms
     → actual value must be number or bigint, received "undefined"
 ❯ tests/processors/providers/github-copilot/metrics/engagement.test.ts (8 tests | 6 failed) 13ms
   × CopilotEngagementProcessor > basic metrics with real session > should calculate session length in minutes 4ms
     → expected 0 to be greater than 0
   × CopilotEngagementProcessor > interruption detection > should detect consecutive user messages as interruptions 0ms
     → expected 0 to be greater than or equal to 1
   × CopilotEngagementProcessor > interruption detection > should detect interruption keywords 0ms
     → expected 0 to be greater than or equal to 1
   × CopilotEngagementProcessor > interruption detection > should calculate interruption rate correctly 2ms
     → expected +0 to be 50 // Object.is equality
   × CopilotEngagementProcessor > engagement scoring > should calculate engagement score between 0-100 1ms
     → actual value must be number or bigint, received "undefined"
   × CopilotEngagementProcessor > engagement scoring > should score higher for more turns 0ms
     → actual value must be number or bigint, received "undefined"
 ❯ tests/processors/providers/codex/metrics/engagement.test.ts (6 tests | 3 failed) 16ms
   × CodexEngagementProcessor > interruption detection > should detect consecutive user messages as interruptions 5ms
     → expected 0 to be greater than or equal to 1
   × CodexEngagementProcessor > interruption detection > should calculate interruption rate correctly 2ms
     → expected +0 to be 50 // Object.is equality
   × CodexEngagementProcessor > engagement scoring > should calculate engagement score between 0-100 1ms
     → actual value must be number or bigint, received "undefined"
 ✓ tests/processors/providers/codex/codex-processor.test.ts (16 tests) 110ms
 ❯ tests/processors/providers/github-copilot/metrics/error.test.ts (6 tests | 4 failed) 5ms
   × CopilotErrorProcessor > basic metrics with real session > should include error metadata 2ms
     → expected undefined to be defined
   × CopilotErrorProcessor > error detection > should detect "error:" pattern 0ms
     → expected 0 to be greater than 0
   × CopilotErrorProcessor > error detection > should detect API errors 0ms
     → expected 0 to be greater than 0
   × CopilotErrorProcessor > error detection > should return high health score for error-free session 1ms
     → expected undefined to be 100 // Object.is equality
 ❯ tests/processors/providers/codex/metrics/error.test.ts (6 tests | 4 failed) 12ms
   × CodexErrorProcessor > basic metrics with real session > should include error metadata 2ms
     → expected undefined to be defined
   × CodexErrorProcessor > error detection > should detect "error:" pattern 0ms
     → expected 0 to be greater than 0
   × CodexErrorProcessor > error detection > should detect API errors 0ms
     → expected 0 to be greater than 0
   × CodexErrorProcessor > error detection > should return high health score for error-free session 3ms
     → expected undefined to be 100 // Object.is equality
 ❯ tests/processors/providers/opencode/metrics/error.test.ts (6 tests | 4 failed) 17ms
   × OpenCodeErrorProcessor > basic metrics with real session > should include error metadata 9ms
     → expected undefined to be defined
   × OpenCodeErrorProcessor > error detection > should detect "error:" pattern 1ms
     → expected 0 to be greater than 0
   × OpenCodeErrorProcessor > error detection > should detect API errors 0ms
     → expected 0 to be greater than 0
   × OpenCodeErrorProcessor > error detection > should return high health score for error-free session 1ms
     → expected undefined to be 100 // Object.is equality
 ❯ tests/processors/providers/opencode/metrics/performance.test.ts (5 tests | 1 failed) 8ms
   × OpenCodePerformanceProcessor > response time calculations > should calculate performance score between 0-100 3ms
     → actual value must be number or bigint, received "undefined"
 ❯ tests/processors/providers/github-copilot/metrics/performance.test.ts (5 tests | 1 failed) 6ms
   × CopilotPerformanceProcessor > response time calculations > should calculate performance score between 0-100 3ms
     → actual value must be number or bigint, received "undefined"
 ❯ tests/processors/providers/codex/metrics/performance.test.ts (5 tests | 1 failed) 11ms
   × CodexPerformanceProcessor > response time calculations > should calculate performance score between 0-100 2ms
     → actual value must be number or bigint, received "undefined"
 ❯ tests/processors/providers/github-copilot/metrics/usage.test.ts (5 tests | 1 failed) 6ms
   × CopilotUsageProcessor > input clarity scoring > should score high for detailed technical messages 4ms
     → expected 0 to be greater than 30
 ❯ tests/processors/providers/opencode/metrics/usage.test.ts (5 tests | 1 failed) 8ms
   × OpenCodeUsageProcessor > input clarity scoring > should score high for detailed technical messages 2ms
     → expected 0 to be greater than 30
 ❯ tests/processors/providers/codex/metrics/usage.test.ts (5 tests | 1 failed) 19ms
   × CodexUsageProcessor > input clarity scoring > should score high for detailed technical messages 8ms
     → expected 0 to be greater than 30
 ❯ tests/processors/providers/github-copilot/metrics/quality.test.ts (4 tests | 1 failed) 5ms
   × CopilotQualityProcessor > iteration counting > should detect corrections and iterations 3ms
     → expected 0 to be greater than 0
 ❯ tests/processors/providers/opencode/metrics/quality.test.ts (4 tests | 1 failed) 12ms
   × OpenCodeQualityProcessor > iteration counting > should detect corrections and iterations 3ms
     → expected 0 to be greater than 0
 ❯ tests/processors/providers/codex/metrics/quality.test.ts (4 tests | 1 failed) 11ms
   × CodexQualityProcessor > iteration counting > should detect corrections and iterations 2ms
     → expected 0 to be greater than 0
 ✓ tests/processors/claude-code.test.ts (6 tests) 8ms

 Test Files  21 failed | 23 passed (44)
      Tests  52 failed | 643 passed (695)
   Start at  22:23:28
   Duration  1.44s (transform 1.75s, setup 0ms, collect 6.20s, tests 1.20s, environment 4ms, prepare 1.83s)

 ELIFECYCLE  Test failed. See above for more details.
